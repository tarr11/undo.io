<% if !@file.nil?%>
    <%= render 'note_view' %>
<% end%>

<% if @file.nil? %>
    <div style="position: relative;">
      <div id="move-modal" class="modal hide fade">
        <%=form_tag(url_for(:action=>"move", :path=>params[:path]), :method=>"move", :id=>"move-form") do %>
        <div class="modal-header">
          <a href="#" class="close">&times;</a>
          <h3>Move Directory "<%=@taskfolder.path%>"</h3>
        </div>
        <div class="modal-body">
            <div class="clearfix">
             <div>This will move all files in this directory (and sub-directories) to a new path</div>
            <div>Enter a new path</div>
            <div><input type="text" name="filename" class="span8" value="<%=@taskfolder.path%>"></div>
            </div>
        </div>
        <div class="modal-footer">
          <button class="btn primary">Move</button>
          <a href="#" id="cancel-move-file" class="btn secondary cancel">Cancel</a>
        </div>
         <% end %>
      </div>
    </div>

    <% content_for :buttons do %>
        <%= link_to "New", {:controller => "task_folder", :action=>"new_file", :path=>params[:path]}, :class=>"btn primary"%>
        <% unless @taskfolder.path == "/" %>
        <!--<a href="#" id="move-button" class="btn">Move</a>-->
        <% end %>
    <% end %>

    <%= render 'pill_views', :selected_view => :notes%>

    <ul style="margin-left:0em;">
        <% @changed_files_by_date.each do |date_item| %>
          <li class="undo-divider"><%=date_item.first%></li>
          <% date_item.second.sort_by{|a| a[:file].revision_at}.reverse.each do |file| %>
              <li class="undo-ul-li-heading"><%= link_to  file[:file].shortName, :controller => "task_folder", :action=>"folder_view", :path=> file[:file].filename, :only_path => @only_path%></li>
              <%file[:changedLines].each do |line|%>
                   <li class="undo-ul-li-desc"><%=line.html_safe%></li>
              <% end%>
              <li class="undo-ul-li-desc path"><%=time_ago_in_words(file[:file].revision_at)%> ago in <%= link_to file[:file].path, :controller => "task_folder", :action=>"folder_view", :path=> file[:file].path, :only_path => @only_path%></li>
              <% if file[:changedLines].length > 3 %>
              <li class="undo-ul-li-desc italics"><%=pluralize([:changedLines].length,"change", "more changes")%></li>
              <% else %>
              <li class="undo-ul-li-desc italics"><%=pluralize([:changedLines].length,"change")%></li>
              <% end %>
          <% end %>
        <% end %>
      </ul>
 <% end %>