<%=@range%>
<ul class="date-menu">

 <% if !@uplevel.nil? %>
<div>

 <%= link_to "Up to " + @uplevel, :controller=> "task_folder", :action=>"show",  :path => @uplevel%></div>
  </div>
  <% end %>
      <%=%>
  <li>Dates: </li>
  <% @ranges.each do |range|%>
      <li>
        <%= link_to range[:name], :controller=> "task_folder", :action=>"show",  :path => params[:path], :range => range[:range]%></div>
      </li>
  <% end %>
 </ul>
<div class="clear"></div>
<div class="header-bar">
<% @columnItems.each_with_index do |folder, index| %>
    <div class="folder-header">
      <% if index == 0 %>
      <%= link_to folder[:folder].name, :controller=> "task_folder", :action=>"show",  :path => folder[:folder].name%>
      <% else %>
      <%= link_to folder[:folder].shortName + "/", :controller=> "task_folder", :action=>"show",  :path => folder[:folder].name%>
      <% end%>
    </div>
   <% end %>

<div class="clear"></div>

<div class="box-bar">
<% 0.upto(@rows) do |row| %>
   <% 0.upto(@cols) do |col|%>
          <% if @matrix[[col,row]].nil?%>
             <div class="box empty">
             <!-- <%=col%>:<%=row%> = empty-->
            </div>
          <% else %>
             <div class="box">
               <div class="box-header">
                    <div class="filename">
                      <% if @matrix[[col,row]][:item].class.to_s == "TodoFile" %>
                          <%= link_to @matrix[[col,row]][:item].shortName, @matrix[[col,row]][:item]%></div>
                       <% else %>
                      <% if row == 0 %>
                              <%= link_to @matrix[[col,row]][:item].shortName + "/ summary", :controller=> "task_folder", :action=>"show",  :path => @matrix[[col,row]][:item].name%></div>

                      <% else %>
                              <%= link_to @matrix[[col,row]][:item].shortName + "/", :controller=> "task_folder", :action=>"show",  :path => @matrix[[col,row]][:item].name%></div>

                      <% end %>
<!--                          <div class="file-summary">
                            <%@matrix[[col,row]][:changes].each do |item|%>
                                <div><%=item[:file].name%></div>
                            <% end%>
                          </div>-->
                      <% end %>
                    </div>
                 <div class="task">
                 <% if @matrix[[col,row]][:changes].length > 0%>
                    <%@matrix[[col,row]][:changes].first(3).each do |change|
                       if @matrix[[col,row]][:item].class.to_s  == "TodoFile"
                            rowCount = 5
                       else
                            rowCount = 1
                       end
                       change[:changedLines].first(rowCount).each do |line|%>
                           <div><%=line%></div>
                       <% end %>
                           <% if @matrix[[col,row]][:item].class.to_s  == "TaskFolder"%>
                              <div style="color:gray;padding-left:5px">in <%=change[:file].filename%> (<%=change[:changedLines].length%> changes)</div>
                           <% end%>

                    <% end %>

                 <% end %>

                 </div>

            </div>
          <% end %>

    <%end%>
    <div class="clear"></div>
<%end%>
</div>
